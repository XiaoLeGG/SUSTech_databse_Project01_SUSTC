# SUSTech_DataBase_Project01_SUSTC

## 项目基本信息

### 项目作者

- 项目作者01
  - 姓名：罗嘉诚（Jiacheng Luo）
  - 学号：12112910
  - 实验课：Lab2
- 项目作者02
  - 姓名：伦天乐（Tianle Lun）
  - 学号：12113019
  - 实验课：Lab2

### 各成员项目贡献

根据小组内部讨论并达成一致，建议最终项目贡献比：

- 罗嘉诚：50%
- 伦天乐：50%

各任务详细贡献如下：

1. 绘制 E-R 图：罗嘉诚。
2. 根据 E-R 图创建数据表：伦天乐。
3. 项目报告撰写：罗嘉诚（50%）、伦天乐（50%）。

## Task 1： E-R 图

根据项目说明中提供的逻辑，迭代多次版本。

使用 `亿图图示` 图形绘制软件，绘制项目的 E-R 图，提供截图如下：

![ER diagram](https://raw.githubusercontent.com/Maystern/picbed/main/img/202210171408709.png)

##  Task 2： 数据库设计

使用附录中 `table_maker.sql` 文件使用 `DDL` 创建数据表。

### 数据库设计

使用 `Show Visualization` 显示表设计及关系。

在 `DataGrip` 中创建数据表后并全选，右键 `Diagram > Show Visualization` ，

保存图片如下：

![container](https://raw.githubusercontent.com/Maystern/picbed/main/img/202210171421476.png)

### 合理性说明

#### 数据表及其列含义说明

在数据表构建中，我们创建了 $9$ 个数据表，数据表和其中列、外键的含义如下：

- `item` 存储项目信息，包括基本信息`type` (项目的类型)、`price` (项目的价格)、`name` （项目的名称，由于它是`unique`的，将其作为主键）、`log_time`（项目最新更新时间）；以及项目出口、进口、寄送、检索、打包、装船的相关信息（分别使用外键`import_information`、`export_information`、`delivery_information`、`retrieval_information`、`container`、`ship`表示）。
- `retrieval_information` 存储检索步骤的信息，包括基本信息`city`（检索城市）、`start_time` （检索时间）、`id` (检索信息的编号，是自增列，将它设为主键)；以及检索时快递员的相关信息（使用外键`retrieval_courier`表示） 
- `delivery_information` 存储寄送步骤的信息，包括基本信息`city`（检索城市）、`finish_time` （结束时间）、`id` (检索信息的编号，是自增列，将它设为主键)；以及检索时快递员的相关信息（使用外键`delivery_courier`表示）
- `export_information` 存储出口的信息，包括基本信息`city`（出口城市）、`time` （出口时间）、`tax` （出口税费）、`id` (出口信息的编号，是自增列，将它设为主键)
- `import_information` 存储进口的信息，包括基本信息`city`（进口城市）、`time` （进口时间）、`tax` （进口税费）、`id` (进口信息的编号，是自增列，将它设为主键)
- `ship` 存储装船的信息，包括基本信息`company`（管理船的公司）、`name` （船的名称，由于它是`unique`的，将其作为主键）
- `container` 存储打包的信息，包括基本信息 `type` （集装箱的类型）、`code` （集装箱的编号, 由于它是`unique`的，将其作为主键）
- `retrieval_courier` 存储检索快递员的信息，包括基本信息 `name` （姓名）、`gender` （性别）、`age` （年龄）、`company` （所属的公司）、`phone_number`（电话号码，我们认为，不同快递员的手机号是不同的，所以将其作为主键）
- `delivery_courier` 存储寄送快递员的信息，包括基本信息 `name` （姓名）、`gender` （性别）、`age` （年龄）、`company` （所属的公司）、`phone_number`（电话号码，我们认为，不同快递员的手机号是不同的，所以将其作为主键）

#### 数据库构建满足三大范式

数据库三大范式的定义如下：

>  第一范式：数据库表的每一列都是不可分割的基本数据项，同一列中不能有多个值。
>
>  第二范式：每个表必须有主关键字,其他数据元素与主关键字一一对应。
>
>  第三范式：表中所有数据元素不但唯一地被主关键字所标识,而且它们之间必须相互独立,不存在其他函数关系。

通过示意图可以看到，对于每一个数据表，每一列都是不可分割，在当前应用场景下，同一列没有多个值。每个表都有主关键字，主关键字不是`unique`（独一无二）就是`自动编号`数字，其他数据元素能和主关键字一一对应。通过设计外键连接，我们将同一数据表中具有“传递”关系的数据列设计成不同的表格进行设计。

可以看到，按照以上设计思想设计出的数据库满足三大范式的要求。

#### 数据库构建的其他要求

根据项目要求文档 `CS307-2022Fall_Project1.pdf`所指出的详细的注意点，在本报告中依次叙述：

1. 数据库的构建，既依据项目说明又依据`shipment_records.csv`中的数据（参考列名称、数据值得范围），后续通过能完全导入给出得数据，来进一步验证这一点。
2. 数据库得构建，严格地遵循了三大范式得要求。
3. 数据库得构建是用主键描述最重要、最有辨识度的属性，并且通过外键描述数据表之间的关系。
4. 数据库中每个数据表中的每一行数据都由其主键列唯一标识。
5. 如图可见，没有一个数据表是孤立的。
6. 如图可见，表和表之间通过外键形成树的形状，不存在外键成环情况。
7. 每个表至少含有一列是非空的，这在数据库构建时使用`not null`约束加以限制。
8. 每个表除了系统自增的ID列，至少有一列采用`unique`约束。
9. 在数据表中，所有数据都采用合适的数据类型加以存储，如姓名、公司等文本，使用`varchar()`来存储，性别字符采用`char`来存储，税收小数采用`numeric()`来存储，价格正整数采用`integer`来存储，每个项目的更新时间因为要精确到时分秒，采用`timestamp`来存储，而其他只需要精确到年月日的时间则采用`date`来存储。
10. 上述数据库中数据表的构建，具有很强的可扩展性，这在接下来的实验中将有所体现。

## Task 3： 数据导入

